<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Input Demo - Web Speech API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glassmorphism {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-8">
    <div class="container max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">ðŸŽ¤ Voice Input Demo</h1>
            <p class="text-white/70 text-lg">Web Speech API Implementation Test</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Voice Input Card -->
            <div class="glassmorphism rounded-2xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-white">Voice Input</h3>
                    <button id="speakBtn" disabled class="p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 disabled:opacity-50 transition-all duration-200">
                        ðŸ”Š
                    </button>
                </div>

                <!-- Microphone Button -->
                <div class="flex justify-center mb-6">
                    <button id="micBtn" class="relative p-6 rounded-full transition-all duration-300 bg-green-500/20 border-2 border-green-500/40 hover:bg-green-500/30 shadow-lg">
                        <div id="pulseRing" class="absolute inset-0 rounded-full bg-red-500/20 hidden"></div>
                        <div class="text-4xl" id="micIcon">ðŸŽ¤</div>
                    </button>
                </div>

                <!-- Status -->
                <div class="text-center mb-4">
                    <div id="status" class="text-gray-300">Click the microphone to start</div>
                </div>

                <!-- Error Display -->
                <div id="error" class="mb-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg hidden">
                    <div class="flex items-center gap-2">
                        <span class="text-red-300 text-sm"></span>
                    </div>
                </div>

                <!-- Transcript Display -->
                <div class="min-h-[120px] max-h-[200px] overflow-y-auto">
                    <div class="glassmorphism rounded-xl p-4">
                        <div class="text-white/90 text-sm mb-2 flex justify-between items-center">
                            <span>Transcribed Text:</span>
                            <button id="clearBtn" class="text-xs px-3 py-1 bg-red-500/20 hover:bg-red-500/30 rounded-full transition-colors hidden">
                                Clear
                            </button>
                        </div>
                        
                        <div id="transcript" class="min-h-[60px] text-white leading-relaxed">
                            <span class="text-white/40 italic" id="placeholder">
                                No speech detected yet. Try saying "Hello World"
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="mt-4 text-center">
                    <p class="text-white/60 text-sm">ðŸ’¡ Tip: Speak clearly and wait for the text to appear</p>
                </div>
            </div>

            <!-- Transcript History -->
            <div class="glassmorphism rounded-2xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-white">Transcript History</h3>
                    <button id="clearHistoryBtn" class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/40 rounded-lg text-red-300 text-sm transition-all duration-200 hidden">
                        Clear History
                    </button>
                </div>

                <div id="history" class="space-y-3 max-h-[400px] overflow-y-auto">
                    <div class="text-center py-8">
                        <p class="text-white/50 italic">No transcripts yet. Start speaking to see results here.</p>
                    </div>
                </div>

                <!-- Test Instructions -->
                <div class="mt-6 pt-4 border-t border-white/20">
                    <h4 class="text-sm font-semibold text-white mb-2">Test Commands:</h4>
                    <div class="space-y-1 text-sm text-white/70">
                        <div>â€¢ "Hello World"</div>
                        <div>â€¢ "This is a test"</div>
                        <div>â€¢ "Web Speech API works"</div>
                        <div>â€¢ Try speaking longer sentences</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Browser Compatibility -->
        <div class="mt-8 glassmorphism rounded-xl p-4 text-center">
            <p class="text-white/70 text-sm">
                <strong>Browser Compatibility:</strong> This demo works best in Chrome, Edge, and Safari. 
                Firefox has limited support.
            </p>
        </div>
    </div>

    <script>
        let recognition = null;
        let isListening = false;
        let transcriptHistory = [];
        
        // Elements
        const micBtn = document.getElementById('micBtn');
        const micIcon = document.getElementById('micIcon');
        const pulseRing = document.getElementById('pulseRing');
        const status = document.getElementById('status');
        const error = document.getElementById('error');
        const transcript = document.getElementById('transcript');
        const placeholder = document.getElementById('placeholder');
        const clearBtn = document.getElementById('clearBtn');
        const speakBtn = document.getElementById('speakBtn');
        const history = document.getElementById('history');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                showError('Speech recognition not supported in this browser. Please use Chrome, Edge, or Safari.');
                micBtn.disabled = true;
                return;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                console.log('Speech recognition started');
                isListening = true;
                updateUI();
                hideError();
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    if (result.isFinal) {
                        finalTranscript += result[0].transcript;
                    } else {
                        interimTranscript += result[0].transcript;
                    }
                }

                if (finalTranscript) {
                    addToTranscript(finalTranscript);
                    addToHistory(finalTranscript);
                } else if (interimTranscript) {
                    showInterimText(interimTranscript);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                let errorMessage = 'Speech recognition error';
                
                switch (event.error) {
                    case 'no-speech':
                        errorMessage = 'No speech detected';
                        break;
                    case 'audio-capture':
                        errorMessage = 'Microphone not available';
                        break;
                    case 'not-allowed':
                        errorMessage = 'Microphone access denied';
                        break;
                    case 'network':
                        errorMessage = 'Network error occurred';
                        break;
                    default:
                        errorMessage = `Speech recognition error: ${event.error}`;
                }
                
                showError(errorMessage);
                isListening = false;
                updateUI();
            };

            recognition.onend = () => {
                console.log('Speech recognition ended');
                isListening = false;
                updateUI();
            };
        }

        function toggleListening() {
            if (!recognition) return;

            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function updateUI() {
            if (isListening) {
                micIcon.textContent = 'ðŸ›‘';
                pulseRing.classList.remove('hidden');
                pulseRing.classList.add('pulse');
                status.textContent = 'ðŸŽ¤ Listening...';
                status.className = 'text-green-300 font-medium';
                micBtn.className = 'relative p-6 rounded-full transition-all duration-300 bg-red-500/20 border-2 border-red-500/40 shadow-lg';
            } else {
                micIcon.textContent = 'ðŸŽ¤';
                pulseRing.classList.add('hidden');
                pulseRing.classList.remove('pulse');
                status.textContent = 'Click the microphone to start';
                status.className = 'text-gray-300';
                micBtn.className = 'relative p-6 rounded-full transition-all duration-300 bg-green-500/20 border-2 border-green-500/40 hover:bg-green-500/30 shadow-lg';
            }
        }

        function addToTranscript(text) {
            if (placeholder && !placeholder.classList.contains('hidden')) {
                placeholder.classList.add('hidden');
            }
            
            const span = document.createElement('span');
            span.textContent = text + ' ';
            transcript.appendChild(span);
            
            clearBtn.classList.remove('hidden');
            speakBtn.disabled = false;
        }

        function showInterimText(text) {
            let interimSpan = document.getElementById('interim');
            if (!interimSpan) {
                interimSpan = document.createElement('span');
                interimSpan.id = 'interim';
                interimSpan.className = 'text-white/60 italic';
                transcript.appendChild(interimSpan);
            }
            interimSpan.textContent = text;
        }

        function addToHistory(text) {
            transcriptHistory.push({
                text: text,
                timestamp: new Date().toLocaleTimeString()
            });

            updateHistory();
        }

        function updateHistory() {
            if (transcriptHistory.length === 0) {
                history.innerHTML = `
                    <div class="text-center py-8">
                        <p class="text-white/50 italic">No transcripts yet. Start speaking to see results here.</p>
                    </div>
                `;
                clearHistoryBtn.classList.add('hidden');
                return;
            }

            clearHistoryBtn.classList.remove('hidden');
            
            history.innerHTML = transcriptHistory.map((item, index) => `
                <div class="glassmorphism rounded-lg p-3">
                    <div class="flex items-start justify-between mb-1">
                        <span class="text-xs text-white/60">#${index + 1}</span>
                        <span class="text-xs text-white/60">${item.timestamp}</span>
                    </div>
                    <p class="text-white leading-relaxed">"${item.text}"</p>
                </div>
            `).join('');
        }

        function clearTranscript() {
            transcript.innerHTML = '';
            const interimSpan = document.getElementById('interim');
            if (interimSpan) {
                interimSpan.remove();
            }
            
            if (placeholder) {
                placeholder.classList.remove('hidden');
                transcript.appendChild(placeholder);
            }
            
            clearBtn.classList.add('hidden');
            speakBtn.disabled = true;
        }

        function clearHistory() {
            transcriptHistory = [];
            updateHistory();
        }

        function speakText() {
            if ('speechSynthesis' in window) {
                const text = Array.from(transcript.children)
                    .filter(child => child.id !== 'interim' && !child.classList.contains('text-white/40'))
                    .map(child => child.textContent)
                    .join('');
                
                if (text.trim()) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    speechSynthesis.speak(utterance);
                }
            }
        }

        function showError(message) {
            error.querySelector('span').textContent = message;
            error.classList.remove('hidden');
        }

        function hideError() {
            error.classList.add('hidden');
        }

        // Event listeners
        micBtn.addEventListener('click', toggleListening);
        clearBtn.addEventListener('click', clearTranscript);
        clearHistoryBtn.addEventListener('click', clearHistory);
        speakBtn.addEventListener('click', speakText);

        // Initialize
        initSpeechRecognition();
    </script>
</body>
</html>
